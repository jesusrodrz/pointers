define(['jquery','ko','Magento_Ui/js/form/form','Magento_Customer/js/customer-data','Magento_Customer/js/model/customer','mage/translate','mage/url',],function($,ko,Component,customerData,customer,$t,url){'use strict';var callToAction='';var zonInf=null;var cpInf=null;function refreshDom(hide=true){if(callToAction=='header'){$('.zonificacion-cp-button').prop('disabled',false);$('.zonificacion-cp-input').val("");}else{$('.zonificacion-cp-modal-button').prop('disabled',false);$('.zonificacion-cp-modal-input').val("");if(hide){$('.zonificacion-cp-modal-background').addClass('d-none');}}}
function showResult(res,zc){refreshDom();if(res["resultado"].toLowerCase()=="ok"){var redirect_url=res["redirect_url"];if(redirect_url){if(callToAction=='tocart'){setLocalStorage('callToAction',callToAction);setLocalStorage('quantity',$("#qty").val());$(".swatch-opt .swatch-attribute").each(function(i,obj){setLocalStorage('configurable',true);$(obj).find(".selected").each(function(i,obj2){setLocalStorage($(obj).attr('attribute-code'),$(obj2).attr('id'));});});}
var path=(redirect_url).split("/");if(redirect_url!=window.location.href&&typeof path[3]!=="undefined"&&path[3].length>2){window.setTimeout(function(){window.location.href=redirect_url;},100);return;}}else if(callToAction=='tocart'){$('.tocart').trigger('click');}}else if(res["error"]){$('.modal-show-message').removeClass('d-none');}}
function validateZipCode(zc){if(/(^\d{5,6}$)/.test(zc)){if(callToAction=='tocart'){var responce_Url='/checkout/cart/';}else{var responce_Url=$('.zonificacion-cp-input-url-to-response').val();}
$.ajax({url:url.build("zonificacion/index/index"),data:{'zipcode':zc,'url-to-response':$('.zonificacion-cp-input-url-to-response').val()},type:'post',dataType:'json',success:function(res){if(res.error){if($('#zonificacion-cp-input').val()!=''){}else{showMessageDialog("Actualmente para tu zona no contamos con venta en línea, te invitamos a visitar tu tienda Interceramic mas cercana");}}
if(res['zif']==1){zonInf=res;cpInf=zc;showMessageDialog('Estimado cliente: Considere que para la región en la que se encuentra los precios de nuestros productos incluyen el IVA del 8%.',0);}else{saveInformation(res);showResult(res,zc);}}});}else{$('.modal-show-message').removeClass('d-none');refreshDom(false);}}
function setLocalStorage(name,value){if(localStorage.name){localStorage.name=value;}else{localStorage.setItem(name,value);}}
function cleanLocalStorage(borrar_guest=true){if(localStorage.zonificacion_){localStorage.removeItem("zonificacion_");if(borrar_guest){localStorage.removeItem("is_guest");}}}
function saveInformation(zonificacion){if(typeof zonificacion['guest']!=="undefined"&&zonificacion['guest']=="1"){setLocalStorage('is_guest',1);}else{setLocalStorage('is_guest',0);}
if(typeof zonificacion["resultado"]!=="undefined"){setLocalStorage('zonificacion_',JSON.stringify(zonificacion));$(".zonificacion-cp-not").hide();$("#zonificacion_city-name").text(zonificacion.city_name);$(".zonificacion-cp").show();}}
function showMessageDialog(text,contact){$('.modal-show-message .card-title').html(text);if(contact){$('.modal-show-message .action-contact').removeClass('d-none');}else{$('.modal-show-message .action-contact').addClass('d-none');}
$('.modal-show-message').removeClass('d-none');}
function cerrarSesion(){setLocalStorage('is_guest',0);if(!$("#close_session").length){var url_cierra=url.build("/customer/account/logout");url_cierra=url_cierra.replace('//customer','/customer');$("#tooltip-account").append("<li>"+
"<a id='close_session' href='"+url_cierra+"'>"+
"<span>Cerrar sesión</span>"+
"</a>"+
"</li>");}}
$('.zonificacion-cp-change').on('click',function(){$('.zonificacion-cp,.zonificacion-cp-not').toggleClass('d-none');});$('.zonificacion-cp-button').on('click',function(){callToAction='header';$(this).prop('disabled',true);validateZipCode($('.zonificacion-cp-input').val());});$('.zonificacion-cp-modal-button').on('click',function(){callToAction='tocart';$(this).prop('disabled',true);validateZipCode($('.zonificacion-cp-modal-input').val());});$('.zonificacion-cp-modal-input').on('keypress',function(event){var keycode=(event.keyCode?event.keyCode:event.which);if(keycode=='13'){callToAction='tocart';$(this).prop('disabled',true);validateZipCode($('.zonificacion-cp-modal-input').val());}});$('.zonificacion-cp-modal-close').on('click',function(){$('.zonificacion-cp-modal-background').addClass('d-none');});$('.modal-show-message').on('click','.modal-close',function(){$('.modal-show-message').addClass('d-none');if(zonInf){saveInformation(zonInf);showResult(zonInf,cpInf);}});if(typeof localStorage.zonificacion_!=="undefined"&&localStorage.is_guest=="1"){var path=(window.location.pathname).split("/");var data=JSON.parse(localStorage.zonificacion_);if(path[1].length==2&&typeof data.city_name!=="undefined"){$("#zonificacion_city-name").text("");$(".zonificacion-cp").hide();$(".zonificacion-cp-not").show();cleanLocalStorage(false);}}
return Component.extend({initialize:function(){this._super();if(typeof localStorage.is_guest!=="undefined"&&localStorage.is_guest=="0"){cerrarSesion();}
if(typeof localStorage.is_guest==="undefined"||localStorage.is_guest=="0"){var url_zonifica=url.build("/zonificacion/index/index");url_zonifica=url_zonifica.replace('//zonificacion','/zonificacion');$.ajax({url:url_zonifica,data:{'database':'1'},type:'post',dataType:'json',success:function(res){if(res['guest']=="0"){cerrarSesion();if(typeof localStorage.zonificacion_!=="undefined"&&typeof res['zipcode']!=="undefined"){var data=JSON.parse(localStorage.zonificacion_);if(data.zipcode!=res['zipcode']){cleanLocalStorage();saveInformation(res);showResult(res,res['zipcode']);}}else if(typeof res['zipcode']!=="undefined"){cleanLocalStorage();saveInformation(res);showResult(res,res['zipcode']);}}else{saveInformation(res);}}});}},getCityName:ko.computed(function(){if(typeof localStorage.zonificacion_!=="undefined"){var data=JSON.parse(localStorage.zonificacion_);return(typeof data.city_name!=="undefined")?data.city_name:"";}else{return "";}}),canSeeCityName:ko.computed(function(){if(typeof localStorage.zonificacion_!=="undefined"){var data=JSON.parse(localStorage.zonificacion_);return(typeof localStorage.zonificacion_!=="undefined"&&typeof data.city_name!=="undefined");}else{return false;}}),pedirCP:function(){$(".zonificacion-cp").hide();$(".zonificacion-cp-not").show();},enviarCP:function(){callToAction='header';$("#button-addon2").prop('disabled',true);validateZipCode($('.zonificacion-cp-input').val());},check(data,event){var keycode=(event.keyCode?event.keyCode:event.which);if(keycode=='13'){callToAction='header';$("#button-addon2").prop('disabled',true);validateZipCode($('.zonificacion-cp-input').val());}}});});